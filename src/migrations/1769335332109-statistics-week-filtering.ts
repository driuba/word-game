import type { MigrationInterface, QueryRunner } from "typeorm";

export class StatisticsWeekFiltering1769335332109 implements MigrationInterface {
    name = 'StatisticsWeekFiltering1769335332109'

    public async up(queryRunner: QueryRunner): Promise<void> {
        await queryRunner.query(`DELETE FROM "wg"."typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","StatisticsGlobal","wg"]);
        await queryRunner.query(`DROP VIEW "StatisticsGlobal"`);
        await queryRunner.query(`DELETE FROM "wg"."typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","StatisticsChannel","wg"]);
        await queryRunner.query(`DROP VIEW "StatisticsChannel"`);
        await queryRunner.query(`CREATE VIEW "StatisticsChannel" AS WITH "WordsInactiveAll" AS (SELECT * FROM "wg"."Words" "w" WHERE NOT "w"."Active"), "WordsInactiveWeek" AS (SELECT * FROM "WordsInactiveAll" "wia" WHERE COALESCE("wia"."Modified", "wia"."Created") >= date_trunc('week', now())), "ChannelUsers" AS (SELECT "wia"."ChannelId", "wia"."UserIdCreator" AS "UserId" FROM "WordsInactiveAll" "wia" UNION SELECT "wia"."ChannelId", "wia"."UserIdGuesser" AS "UserId" FROM "WordsInactiveAll" "wia" WHERE "wia"."UserIdGuesser" IS NOT NULL), "GuessesAll" AS (SELECT "w"."ChannelId", "w"."UserIdGuesser" AS "UserId", COUNT(1) AS "Guesses" FROM "WordsInactiveAll" "w" WHERE "w"."UserIdGuesser" IS NOT NULL GROUP BY "w"."ChannelId", "w"."UserIdGuesser"), "GuessesWeek" AS (SELECT "w"."ChannelId", "w"."UserIdGuesser" AS "UserId", COUNT(1) AS "Guesses" FROM "WordsInactiveWeek" "w" WHERE "w"."UserIdGuesser" IS NOT NULL GROUP BY "w"."ChannelId", "w"."UserIdGuesser"), "ScoresAll" AS (SELECT "w"."ChannelId", "w"."UserIdCreator" AS "UserId", COUNT(1) AS "Count", COUNT("w"."Expired") AS "CountExpired", SUM("w"."Score") AS "Score", AVG("w"."Score") AS "Average", MAX("w"."Score") AS "Maximum" FROM "WordsInactiveAll" "w" GROUP BY "w"."ChannelId", "w"."UserIdCreator"), "ScoresWeek" AS (SELECT "w"."ChannelId", "w"."UserIdCreator" AS "UserId", COUNT(1) AS "Count", COUNT("w"."Expired") AS "CountExpired", SUM("w"."Score") AS "Score", AVG("w"."Score") AS "Average", MAX("w"."Score") AS "Maximum" FROM "WordsInactiveWeek" "w" GROUP BY "w"."ChannelId", "w"."UserIdCreator") SELECT "cu"."ChannelId", "cu"."UserId", COALESCE("sw"."Count", 0) AS "CountWeek", COALESCE("sw"."CountExpired", 0) AS "CountExpiredWeek", COALESCE("sw"."Score", 0) AS "ScoreWeek", COALESCE("sw"."Average", 0) AS "AverageWeek", COALESCE("sw"."Maximum", 0) AS "MaximumWeek", COALESCE("gw"."Guesses", 0) AS "GuessesWeek", COALESCE("sa"."Count", 0) AS "CountAll", COALESCE("sa"."CountExpired", 0) AS "CountExpiredAll", COALESCE("sa"."Score", 0) AS "ScoreAll", COALESCE("sa"."Average", 0) AS "AverageAll", COALESCE("sa"."Maximum", 0) AS "MaximumAll", COALESCE("ga"."Guesses", 0) AS "GuessesAll" FROM "ChannelUsers" "cu" LEFT JOIN "GuessesAll" "ga" ON "ga"."ChannelId" = "cu"."ChannelId" AND "ga"."UserId" = "cu"."UserId"  LEFT JOIN "GuessesWeek" "gw" ON "gw"."ChannelId" = "cu"."ChannelId" AND "gw"."UserId" = "cu"."UserId"  LEFT JOIN "ScoresAll" "sa" ON "sa"."ChannelId" = "cu"."ChannelId" AND "sa"."UserId" = "cu"."UserId"  LEFT JOIN "ScoresWeek" "sw" ON "sw"."ChannelId" = "cu"."ChannelId" AND "sw"."UserId" = "cu"."UserId" ORDER BY "sa"."Score" DESC NULLS LAST, "ga"."Guesses" DESC NULLS LAST, "sa"."Count" ASC NULLS FIRST, "sa"."CountExpired" ASC NULLS FIRST`);
        await queryRunner.query(`INSERT INTO "wg"."typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["wg","VIEW","StatisticsChannel","WITH \"WordsInactiveAll\" AS (SELECT * FROM \"wg\".\"Words\" \"w\" WHERE NOT \"w\".\"Active\"), \"WordsInactiveWeek\" AS (SELECT * FROM \"WordsInactiveAll\" \"wia\" WHERE COALESCE(\"wia\".\"Modified\", \"wia\".\"Created\") >= date_trunc('week', now())), \"ChannelUsers\" AS (SELECT \"wia\".\"ChannelId\", \"wia\".\"UserIdCreator\" AS \"UserId\" FROM \"WordsInactiveAll\" \"wia\" UNION SELECT \"wia\".\"ChannelId\", \"wia\".\"UserIdGuesser\" AS \"UserId\" FROM \"WordsInactiveAll\" \"wia\" WHERE \"wia\".\"UserIdGuesser\" IS NOT NULL), \"GuessesAll\" AS (SELECT \"w\".\"ChannelId\", \"w\".\"UserIdGuesser\" AS \"UserId\", COUNT(1) AS \"Guesses\" FROM \"WordsInactiveAll\" \"w\" WHERE \"w\".\"UserIdGuesser\" IS NOT NULL GROUP BY \"w\".\"ChannelId\", \"w\".\"UserIdGuesser\"), \"GuessesWeek\" AS (SELECT \"w\".\"ChannelId\", \"w\".\"UserIdGuesser\" AS \"UserId\", COUNT(1) AS \"Guesses\" FROM \"WordsInactiveWeek\" \"w\" WHERE \"w\".\"UserIdGuesser\" IS NOT NULL GROUP BY \"w\".\"ChannelId\", \"w\".\"UserIdGuesser\"), \"ScoresAll\" AS (SELECT \"w\".\"ChannelId\", \"w\".\"UserIdCreator\" AS \"UserId\", COUNT(1) AS \"Count\", COUNT(\"w\".\"Expired\") AS \"CountExpired\", SUM(\"w\".\"Score\") AS \"Score\", AVG(\"w\".\"Score\") AS \"Average\", MAX(\"w\".\"Score\") AS \"Maximum\" FROM \"WordsInactiveAll\" \"w\" GROUP BY \"w\".\"ChannelId\", \"w\".\"UserIdCreator\"), \"ScoresWeek\" AS (SELECT \"w\".\"ChannelId\", \"w\".\"UserIdCreator\" AS \"UserId\", COUNT(1) AS \"Count\", COUNT(\"w\".\"Expired\") AS \"CountExpired\", SUM(\"w\".\"Score\") AS \"Score\", AVG(\"w\".\"Score\") AS \"Average\", MAX(\"w\".\"Score\") AS \"Maximum\" FROM \"WordsInactiveWeek\" \"w\" GROUP BY \"w\".\"ChannelId\", \"w\".\"UserIdCreator\") SELECT \"cu\".\"ChannelId\", \"cu\".\"UserId\", COALESCE(\"sw\".\"Count\", 0) AS \"CountWeek\", COALESCE(\"sw\".\"CountExpired\", 0) AS \"CountExpiredWeek\", COALESCE(\"sw\".\"Score\", 0) AS \"ScoreWeek\", COALESCE(\"sw\".\"Average\", 0) AS \"AverageWeek\", COALESCE(\"sw\".\"Maximum\", 0) AS \"MaximumWeek\", COALESCE(\"gw\".\"Guesses\", 0) AS \"GuessesWeek\", COALESCE(\"sa\".\"Count\", 0) AS \"CountAll\", COALESCE(\"sa\".\"CountExpired\", 0) AS \"CountExpiredAll\", COALESCE(\"sa\".\"Score\", 0) AS \"ScoreAll\", COALESCE(\"sa\".\"Average\", 0) AS \"AverageAll\", COALESCE(\"sa\".\"Maximum\", 0) AS \"MaximumAll\", COALESCE(\"ga\".\"Guesses\", 0) AS \"GuessesAll\" FROM \"ChannelUsers\" \"cu\" LEFT JOIN \"GuessesAll\" \"ga\" ON \"ga\".\"ChannelId\" = \"cu\".\"ChannelId\" AND \"ga\".\"UserId\" = \"cu\".\"UserId\"  LEFT JOIN \"GuessesWeek\" \"gw\" ON \"gw\".\"ChannelId\" = \"cu\".\"ChannelId\" AND \"gw\".\"UserId\" = \"cu\".\"UserId\"  LEFT JOIN \"ScoresAll\" \"sa\" ON \"sa\".\"ChannelId\" = \"cu\".\"ChannelId\" AND \"sa\".\"UserId\" = \"cu\".\"UserId\"  LEFT JOIN \"ScoresWeek\" \"sw\" ON \"sw\".\"ChannelId\" = \"cu\".\"ChannelId\" AND \"sw\".\"UserId\" = \"cu\".\"UserId\" ORDER BY \"sa\".\"Score\" DESC NULLS LAST, \"ga\".\"Guesses\" DESC NULLS LAST, \"sa\".\"Count\" ASC NULLS FIRST, \"sa\".\"CountExpired\" ASC NULLS FIRST"]);
        await queryRunner.query(`CREATE VIEW "StatisticsGlobal" AS WITH "Statistic" AS (SELECT "s"."UserId", SUM("s"."CountWeek") AS "CountWeek", SUM("s"."CountExpiredWeek") AS "CountExpiredWeek", SUM("s"."ScoreWeek") AS "ScoreWeek", MAX("s"."MaximumWeek") AS "MaximumWeek", SUM("s"."GuessesWeek") AS "GuessesWeek", SUM("s"."CountAll") AS "CountAll", SUM("s"."CountExpiredAll") AS "CountExpiredAll", SUM("s"."ScoreAll") AS "ScoreAll", MAX("s"."MaximumAll") AS "MaximumAll", SUM("s"."GuessesAll") AS "GuessesAll" FROM "wg"."StatisticsChannel" "s" GROUP BY "s"."UserId") SELECT "s"."UserId", "s"."CountWeek", "s"."CountExpiredWeek", "s"."ScoreWeek", CASE "s"."CountWeek" WHEN 0 THEN 0 ELSE "s"."ScoreWeek" / "s"."CountWeek" END AS "AverageWeek", "s"."MaximumWeek", "s"."GuessesWeek", "s"."CountAll", "s"."CountExpiredAll", "s"."ScoreAll", CASE "s"."CountAll" WHEN 0 THEN 0 ELSE "s"."ScoreAll" / "s"."CountAll" END AS "AverageAll", "s"."MaximumAll", "s"."GuessesAll" FROM "Statistic" "s" ORDER BY "s"."ScoreAll" DESC NULLS LAST, "s"."GuessesAll" DESC NULLS LAST, "s"."CountAll" ASC NULLS FIRST, "s"."CountExpiredAll" ASC NULLS FIRST`);
        await queryRunner.query(`INSERT INTO "wg"."typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["wg","VIEW","StatisticsGlobal","WITH \"Statistic\" AS (SELECT \"s\".\"UserId\", SUM(\"s\".\"CountWeek\") AS \"CountWeek\", SUM(\"s\".\"CountExpiredWeek\") AS \"CountExpiredWeek\", SUM(\"s\".\"ScoreWeek\") AS \"ScoreWeek\", MAX(\"s\".\"MaximumWeek\") AS \"MaximumWeek\", SUM(\"s\".\"GuessesWeek\") AS \"GuessesWeek\", SUM(\"s\".\"CountAll\") AS \"CountAll\", SUM(\"s\".\"CountExpiredAll\") AS \"CountExpiredAll\", SUM(\"s\".\"ScoreAll\") AS \"ScoreAll\", MAX(\"s\".\"MaximumAll\") AS \"MaximumAll\", SUM(\"s\".\"GuessesAll\") AS \"GuessesAll\" FROM \"wg\".\"StatisticsChannel\" \"s\" GROUP BY \"s\".\"UserId\") SELECT \"s\".\"UserId\", \"s\".\"CountWeek\", \"s\".\"CountExpiredWeek\", \"s\".\"ScoreWeek\", CASE \"s\".\"CountWeek\" WHEN 0 THEN 0 ELSE \"s\".\"ScoreWeek\" / \"s\".\"CountWeek\" END AS \"AverageWeek\", \"s\".\"MaximumWeek\", \"s\".\"GuessesWeek\", \"s\".\"CountAll\", \"s\".\"CountExpiredAll\", \"s\".\"ScoreAll\", CASE \"s\".\"CountAll\" WHEN 0 THEN 0 ELSE \"s\".\"ScoreAll\" / \"s\".\"CountAll\" END AS \"AverageAll\", \"s\".\"MaximumAll\", \"s\".\"GuessesAll\" FROM \"Statistic\" \"s\" ORDER BY \"s\".\"ScoreAll\" DESC NULLS LAST, \"s\".\"GuessesAll\" DESC NULLS LAST, \"s\".\"CountAll\" ASC NULLS FIRST, \"s\".\"CountExpiredAll\" ASC NULLS FIRST"]);
    }

    public async down(queryRunner: QueryRunner): Promise<void> {
        await queryRunner.query(`DELETE FROM "wg"."typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","StatisticsGlobal","wg"]);
        await queryRunner.query(`DROP VIEW "StatisticsGlobal"`);
        await queryRunner.query(`DELETE FROM "wg"."typeorm_metadata" WHERE "type" = $1 AND "name" = $2 AND "schema" = $3`, ["VIEW","StatisticsChannel","wg"]);
        await queryRunner.query(`DROP VIEW "StatisticsChannel"`);
        await queryRunner.query(`CREATE VIEW "StatisticsChannel" AS WITH "WordsInactiveAll" AS (SELECT * FROM "wg"."Words" "w" WHERE NOT "w"."Active"), "WordsInactiveWeek" AS (SELECT * FROM "WordsInactiveAll" "wia" WHERE "wia"."Created" >= date_trunc('week', now())), "ChannelUsers" AS (SELECT "wia"."ChannelId", "wia"."UserIdCreator" AS "UserId" FROM "WordsInactiveAll" "wia" UNION SELECT "wia"."ChannelId", "wia"."UserIdGuesser" AS "UserId" FROM "WordsInactiveAll" "wia" WHERE "wia"."UserIdGuesser" IS NOT NULL), "GuessesAll" AS (SELECT "w"."ChannelId", "w"."UserIdGuesser" AS "UserId", COUNT(1) AS "Guesses" FROM "WordsInactiveAll" "w" WHERE "w"."UserIdGuesser" IS NOT NULL GROUP BY "w"."ChannelId", "w"."UserIdGuesser"), "GuessesWeek" AS (SELECT "w"."ChannelId", "w"."UserIdGuesser" AS "UserId", COUNT(1) AS "Guesses" FROM "WordsInactiveWeek" "w" WHERE "w"."UserIdGuesser" IS NOT NULL GROUP BY "w"."ChannelId", "w"."UserIdGuesser"), "ScoresAll" AS (SELECT "w"."ChannelId", "w"."UserIdCreator" AS "UserId", COUNT(1) AS "Count", COUNT("w"."Expired") AS "CountExpired", SUM("w"."Score") AS "Score", AVG("w"."Score") AS "Average", MAX("w"."Score") AS "Maximum" FROM "WordsInactiveAll" "w" GROUP BY "w"."ChannelId", "w"."UserIdCreator"), "ScoresWeek" AS (SELECT "w"."ChannelId", "w"."UserIdCreator" AS "UserId", COUNT(1) AS "Count", COUNT("w"."Expired") AS "CountExpired", SUM("w"."Score") AS "Score", AVG("w"."Score") AS "Average", MAX("w"."Score") AS "Maximum" FROM "WordsInactiveWeek" "w" GROUP BY "w"."ChannelId", "w"."UserIdCreator") SELECT "cu"."ChannelId", "cu"."UserId", COALESCE("sw"."Count", 0) AS "CountWeek", COALESCE("sw"."CountExpired", 0) AS "CountExpiredWeek", COALESCE("sw"."Score", 0) AS "ScoreWeek", COALESCE("sw"."Average", 0) AS "AverageWeek", COALESCE("sw"."Maximum", 0) AS "MaximumWeek", COALESCE("gw"."Guesses", 0) AS "GuessesWeek", COALESCE("sa"."Count", 0) AS "CountAll", COALESCE("sa"."CountExpired", 0) AS "CountExpiredAll", COALESCE("sa"."Score", 0) AS "ScoreAll", COALESCE("sa"."Average", 0) AS "AverageAll", COALESCE("sa"."Maximum", 0) AS "MaximumAll", COALESCE("ga"."Guesses", 0) AS "GuessesAll" FROM "ChannelUsers" "cu" LEFT JOIN "GuessesAll" "ga" ON "ga"."ChannelId" = "cu"."ChannelId" AND "ga"."UserId" = "cu"."UserId"  LEFT JOIN "GuessesWeek" "gw" ON "gw"."ChannelId" = "cu"."ChannelId" AND "gw"."UserId" = "cu"."UserId"  LEFT JOIN "ScoresAll" "sa" ON "sa"."ChannelId" = "cu"."ChannelId" AND "sa"."UserId" = "cu"."UserId"  LEFT JOIN "ScoresWeek" "sw" ON "sw"."ChannelId" = "cu"."ChannelId" AND "sw"."UserId" = "cu"."UserId" ORDER BY "sa"."Score" DESC NULLS LAST, "ga"."Guesses" DESC NULLS LAST, "sa"."Count" ASC NULLS FIRST, "sa"."CountExpired" ASC NULLS FIRST`);
        await queryRunner.query(`INSERT INTO "wg"."typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["wg","VIEW","StatisticsChannel","WITH \"WordsInactiveAll\" AS (SELECT * FROM \"wg\".\"Words\" \"w\" WHERE NOT \"w\".\"Active\"), \"WordsInactiveWeek\" AS (SELECT * FROM \"WordsInactiveAll\" \"wia\" WHERE \"wia\".\"Created\" >= date_trunc('week', now())), \"ChannelUsers\" AS (SELECT \"wia\".\"ChannelId\", \"wia\".\"UserIdCreator\" AS \"UserId\" FROM \"WordsInactiveAll\" \"wia\" UNION SELECT \"wia\".\"ChannelId\", \"wia\".\"UserIdGuesser\" AS \"UserId\" FROM \"WordsInactiveAll\" \"wia\" WHERE \"wia\".\"UserIdGuesser\" IS NOT NULL), \"GuessesAll\" AS (SELECT \"w\".\"ChannelId\", \"w\".\"UserIdGuesser\" AS \"UserId\", COUNT(1) AS \"Guesses\" FROM \"WordsInactiveAll\" \"w\" WHERE \"w\".\"UserIdGuesser\" IS NOT NULL GROUP BY \"w\".\"ChannelId\", \"w\".\"UserIdGuesser\"), \"GuessesWeek\" AS (SELECT \"w\".\"ChannelId\", \"w\".\"UserIdGuesser\" AS \"UserId\", COUNT(1) AS \"Guesses\" FROM \"WordsInactiveWeek\" \"w\" WHERE \"w\".\"UserIdGuesser\" IS NOT NULL GROUP BY \"w\".\"ChannelId\", \"w\".\"UserIdGuesser\"), \"ScoresAll\" AS (SELECT \"w\".\"ChannelId\", \"w\".\"UserIdCreator\" AS \"UserId\", COUNT(1) AS \"Count\", COUNT(\"w\".\"Expired\") AS \"CountExpired\", SUM(\"w\".\"Score\") AS \"Score\", AVG(\"w\".\"Score\") AS \"Average\", MAX(\"w\".\"Score\") AS \"Maximum\" FROM \"WordsInactiveAll\" \"w\" GROUP BY \"w\".\"ChannelId\", \"w\".\"UserIdCreator\"), \"ScoresWeek\" AS (SELECT \"w\".\"ChannelId\", \"w\".\"UserIdCreator\" AS \"UserId\", COUNT(1) AS \"Count\", COUNT(\"w\".\"Expired\") AS \"CountExpired\", SUM(\"w\".\"Score\") AS \"Score\", AVG(\"w\".\"Score\") AS \"Average\", MAX(\"w\".\"Score\") AS \"Maximum\" FROM \"WordsInactiveWeek\" \"w\" GROUP BY \"w\".\"ChannelId\", \"w\".\"UserIdCreator\") SELECT \"cu\".\"ChannelId\", \"cu\".\"UserId\", COALESCE(\"sw\".\"Count\", 0) AS \"CountWeek\", COALESCE(\"sw\".\"CountExpired\", 0) AS \"CountExpiredWeek\", COALESCE(\"sw\".\"Score\", 0) AS \"ScoreWeek\", COALESCE(\"sw\".\"Average\", 0) AS \"AverageWeek\", COALESCE(\"sw\".\"Maximum\", 0) AS \"MaximumWeek\", COALESCE(\"gw\".\"Guesses\", 0) AS \"GuessesWeek\", COALESCE(\"sa\".\"Count\", 0) AS \"CountAll\", COALESCE(\"sa\".\"CountExpired\", 0) AS \"CountExpiredAll\", COALESCE(\"sa\".\"Score\", 0) AS \"ScoreAll\", COALESCE(\"sa\".\"Average\", 0) AS \"AverageAll\", COALESCE(\"sa\".\"Maximum\", 0) AS \"MaximumAll\", COALESCE(\"ga\".\"Guesses\", 0) AS \"GuessesAll\" FROM \"ChannelUsers\" \"cu\" LEFT JOIN \"GuessesAll\" \"ga\" ON \"ga\".\"ChannelId\" = \"cu\".\"ChannelId\" AND \"ga\".\"UserId\" = \"cu\".\"UserId\"  LEFT JOIN \"GuessesWeek\" \"gw\" ON \"gw\".\"ChannelId\" = \"cu\".\"ChannelId\" AND \"gw\".\"UserId\" = \"cu\".\"UserId\"  LEFT JOIN \"ScoresAll\" \"sa\" ON \"sa\".\"ChannelId\" = \"cu\".\"ChannelId\" AND \"sa\".\"UserId\" = \"cu\".\"UserId\"  LEFT JOIN \"ScoresWeek\" \"sw\" ON \"sw\".\"ChannelId\" = \"cu\".\"ChannelId\" AND \"sw\".\"UserId\" = \"cu\".\"UserId\" ORDER BY \"sa\".\"Score\" DESC NULLS LAST, \"ga\".\"Guesses\" DESC NULLS LAST, \"sa\".\"Count\" ASC NULLS FIRST, \"sa\".\"CountExpired\" ASC NULLS FIRST"]);
        await queryRunner.query(`CREATE VIEW "StatisticsGlobal" AS WITH "Statistic" AS (SELECT "s"."UserId", SUM("s"."CountWeek") AS "CountWeek", SUM("s"."CountExpiredWeek") AS "CountExpiredWeek", SUM("s"."ScoreWeek") AS "ScoreWeek", MAX("s"."MaximumWeek") AS "MaximumWeek", SUM("s"."GuessesWeek") AS "GuessesWeek", SUM("s"."CountAll") AS "CountAll", SUM("s"."CountExpiredAll") AS "CountExpiredAll", SUM("s"."ScoreAll") AS "ScoreAll", MAX("s"."MaximumAll") AS "MaximumAll", SUM("s"."GuessesAll") AS "GuessesAll" FROM "wg"."StatisticsChannel" "s" GROUP BY "s"."UserId") SELECT "s"."UserId", "s"."CountWeek", "s"."CountExpiredWeek", "s"."ScoreWeek", CASE "s"."CountWeek" WHEN 0 THEN 0 ELSE "s"."ScoreWeek" / "s"."CountWeek" END AS "AverageWeek", "s"."MaximumWeek", "s"."GuessesWeek", "s"."CountAll", "s"."CountExpiredAll", "s"."ScoreAll", CASE "s"."CountAll" WHEN 0 THEN 0 ELSE "s"."ScoreAll" / "s"."CountAll" END AS "AverageAll", "s"."MaximumAll", "s"."GuessesAll" FROM "Statistic" "s" ORDER BY "s"."ScoreAll" DESC NULLS LAST, "s"."GuessesAll" DESC NULLS LAST, "s"."CountAll" ASC NULLS FIRST, "s"."CountExpiredAll" ASC NULLS FIRST`);
        await queryRunner.query(`INSERT INTO "wg"."typeorm_metadata"("database", "schema", "table", "type", "name", "value") VALUES (DEFAULT, $1, DEFAULT, $2, $3, $4)`, ["wg","VIEW","StatisticsGlobal","WITH \"Statistic\" AS (SELECT \"s\".\"UserId\", SUM(\"s\".\"CountWeek\") AS \"CountWeek\", SUM(\"s\".\"CountExpiredWeek\") AS \"CountExpiredWeek\", SUM(\"s\".\"ScoreWeek\") AS \"ScoreWeek\", MAX(\"s\".\"MaximumWeek\") AS \"MaximumWeek\", SUM(\"s\".\"GuessesWeek\") AS \"GuessesWeek\", SUM(\"s\".\"CountAll\") AS \"CountAll\", SUM(\"s\".\"CountExpiredAll\") AS \"CountExpiredAll\", SUM(\"s\".\"ScoreAll\") AS \"ScoreAll\", MAX(\"s\".\"MaximumAll\") AS \"MaximumAll\", SUM(\"s\".\"GuessesAll\") AS \"GuessesAll\" FROM \"wg\".\"StatisticsChannel\" \"s\" GROUP BY \"s\".\"UserId\") SELECT \"s\".\"UserId\", \"s\".\"CountWeek\", \"s\".\"CountExpiredWeek\", \"s\".\"ScoreWeek\", CASE \"s\".\"CountWeek\" WHEN 0 THEN 0 ELSE \"s\".\"ScoreWeek\" / \"s\".\"CountWeek\" END AS \"AverageWeek\", \"s\".\"MaximumWeek\", \"s\".\"GuessesWeek\", \"s\".\"CountAll\", \"s\".\"CountExpiredAll\", \"s\".\"ScoreAll\", CASE \"s\".\"CountAll\" WHEN 0 THEN 0 ELSE \"s\".\"ScoreAll\" / \"s\".\"CountAll\" END AS \"AverageAll\", \"s\".\"MaximumAll\", \"s\".\"GuessesAll\" FROM \"Statistic\" \"s\" ORDER BY \"s\".\"ScoreAll\" DESC NULLS LAST, \"s\".\"GuessesAll\" DESC NULLS LAST, \"s\".\"CountAll\" ASC NULLS FIRST, \"s\".\"CountExpiredAll\" ASC NULLS FIRST"]);
    }

}
